# Machine-Number-Sense-Dataset  
Code for the AAAI-2020 paper  
Machine Number Sense: A Dataset of Visual Arithmetic Problems for Abstract and Relational Reasoning  
Wenhe Zhang, Chi Zhang, Yixin Zhu, Song-Chun Zhu  
_The 34th AAAI Conferences on Artificial Intelligence_, Februrary 7-12, New York (Oral
Presentation).  
  
As a comprehensive indicator of mathematical thinking and intelligence, the **number sense** bridges the induction of symbolic concepts and the competence of problem-solving. 
To endow such a crucial cognitive ability to machine intelligence, we propose a dataset, **Machine Number Sense (MNS)**, consisting of **visual** arithmetic problems automatically generated using a grammar model---AOG.  

These visual arithmetic problems are in the form of geometric figures: each problem has a set of geometric shapes as its **context** and embedded number **symbols**. 
Solving such problems is not trivial; the machine not only has to recognize the number, but also to interpret the number with its contexts, shapes, and relations (eg, symmetry) together with proper operations.  

Our comprehensive experiments show that current neural-network-based models still struggle to understand number concepts and relational operations. 
A simple brute-force **search algorithm** could work out some of the problems without context information, 
but taking geometric context into account by an additional perception module would provide a sharp performance gain with fewer search steps. 
Altogether, we call for attention in fusing the classic search-based algorithms with modern neural networks to discover the essential number concepts in future research.

## Dataset
The dataset is generated by by parsing and sampling an **And-Or Graph** (AOG) model. 
Each problem has an internal hierarchical tree structure composed of And-nodes and Or-nodes; 
an And-node denotes a decomposition of a larger entity in the grammar, 
and an Or-node denotes an alternative decomposition.  
- We design three problem types: (a) Combination, (b) Composition, and (c) Partition, each of which has a distinctive layout.
- Each problem contains two important components:  
  - Layout component serves as the **problem context**. The attributes vary with different problem types.
  - Algebra component serves as the **problem content**.
    A crucial attribute is the styles of interpretation, including holistic view and analytic view. 
    - From a **holistic perspective**, all the numbers in a panel are involved in the same calculation process together as a whole. 
    - From an **analytic perspective**, the numbers are grouped as several parts, and each part undergoes an individual calculation process.
    

## Benchmarks and Experiments  
We benchmark the proposed MNS dataset using four predominant neural network models and two search-based algorithms. Additionally, human performance on the dataset has also been collected. For more details, please refer to our paper.  

<table>
    <tr>
        <td align="center" rowspan="2"><B>Method</B></td>
        <td align="center" rowspan="2"><B>Mean Acc</B></td>
        <td align="center" colspan="2">      <B>Combination</B>      </td>
        <td align="center" colspan="2">      <B>Composition</B>      </td>
        <td align="center" colspan="2">       <B>Partition</B>       </td>
    </tr>
    <tr>
        <td align="center"><B>Holistic</B></td>
        <td align="center"><B>Analytic</B></td>
        <td align="center"><B>Holistic</B></td>
        <td align="center"><B>Analytic</B></td>
        <td align="center"><B>Holistic</B></td>
        <td align="center"><B>Analytic</B></td>
    </tr>
    <tr>
        <td align="center"> Pure Symbolic Search </td>
        <td align="center"> 52.15% </td>
        <td align="center"> 62.98% </td>
        <td align="center"> 56.83% </td>
        <td align="center"> 22.17% </td>
        <td align="center"> 53.73% </td>
        <td align="center"> 51.29% </td>
        <td align="center"> 71.60% </td>
    </tr>
    <tr>
        <td align="center"> Context-guided Search </td>
        <td align="center"> 56.70% </td>
        <td align="center"> 64.38% </td>
        <td align="center"> 56.08% </td>
        <td align="center"> 29.81% </td>
        <td align="center"> 61.84% </td>
        <td align="center"> 59.70% </td>
        <td align="center"> 67.59% </td>
    </tr>
    <tr>
        <td align="center"> CNN </td>
        <td align="center"> 22.71% </td>
        <td align="center"> 25.25% </td>
        <td align="center"> 19.65% </td>
        <td align="center"> 22.53% </td>
        <td align="center"> 20.07% </td>
        <td align="center"> 24.44% </td>
        <td align="center"> 23.25% </td>
    </tr>
    <tr>
        <td align="center"> LSTM </td>
        <td align="center"> 22.16% </td>
        <td align="center"> 24.57% </td>
        <td align="center"> 21.10% </td>
        <td align="center"> 22.21% </td>
        <td align="center"> 20.12% </td>
        <td align="center"> 23.36% </td>
        <td align="center"> 23.83% </td>
    </tr>
    <tr>
        <td align="center"> RN </td>
        <td align="center"> 22.96% </td>
        <td align="center"> 27.05% </td>
        <td align="center"> 20.47% </td>
        <td align="center"> 22.93% </td>
        <td align="center"> 20.27% </td>
        <td align="center"> 25.81% </td>
        <td align="center"> 23.64% </td>
    </tr>
    <tr>
        <td align="center"> ResNet </td>
        <td align="center"> 25.29% </td>
        <td align="center"> 27.90% </td>
        <td align="center"> 24.22% </td>
        <td align="center"> 23.42% </td>
        <td align="center"> 23.73% </td>
        <td align="center"> 26.61% </td>
        <td align="center"> 27.78% </td>
    </tr>
    <tr>
        <td align="center"> Human </td>
        <td align="center"> 77.58% </td>
        <td align="center"> 66.82% </td>
        <td align="center"> 93.64% </td>
        <td align="center"> 61.36% </td>
        <td align="center"> 78.18% </td>
        <td align="center"> 77.27% </td>
        <td align="center"> 88.18% </td>
    </tr>
</table>

## Dependencies
**Important**  

- Python 2.7
- OpenCV
- PyTorch
- CUDA and cuDNN expected  

See `requirements.txt` for a detailed list of packages required  

## Usage
### Dataset Generation  
Code for dataset generation resides in `src/dataset` folder. To generate a dataset, run  
`main.py` with adjustable sample amount.
### Benchmarking  
Code for benchmarking resides in `src/model` folder.   

## Citation  
If find our work help, please cite us.  
```
@inproceedings{zhang2020number,  
     author={Zhang, Wenhe and Zhang, Chi and Zhu, Yixin and Zhu, Song-Chun},  
     title={Machine Number Sense: A Dataset of Visual Arithmetic Problems for Abstract and Relational Reasoning},  
     booktitle={AAAI Conference on Artificial Intelligence (AAAI)},  
     year={2020}  
 }  
 ```
